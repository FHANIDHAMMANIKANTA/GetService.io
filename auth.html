<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, signInWithPhoneNumber, RecaptchaVerifier } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

// ðŸ”¥ Your Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyAPjy2mUOpmJidV3EmtRR37enN6bRcCohQ",
  authDomain: "getservice-8003b.firebaseapp.com",
  databaseURL: "https://getservice-8003b-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "getservice-8003b",
  storageBucket: "getservice-8003b.firebasestorage.app",
  messagingSenderId: "218679079698",
  appId: "1:218679079698:web:e89d640e7769c63178b9cb"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app);

// ðŸ” Setup reCAPTCHA
window.recaptchaVerifier = new RecaptchaVerifier(auth, 'recaptcha-container', {
  size: 'normal'
}, auth);

// ðŸ“© Send OTP
window.sendOTP = function () {
  const phoneNumber = document.getElementById("phone").value;
  const appVerifier = window.recaptchaVerifier;

  signInWithPhoneNumber(auth, phoneNumber, appVerifier)
    .then((confirmationResult) => {
      window.confirmationResult = confirmationResult;
      alert("OTP Sent Successfully!");
    })
    .catch((error) => {
      alert(error.message);
    });
};

// âœ… Verify OTP
window.verifyOTP = function () {
  const code = document.getElementById("otp").value;

  confirmationResult.confirm(code)
    .then((result) => {
      const user = result.user;

      // Save user in database
      set(ref(db, 'users/' + user.uid), {
        phone: user.phoneNumber,
        role: "user"
      });

      alert("Login Successful!");
      window.location.href = "user-dashboard.html";
    })
    .catch((error) => {
      alert("Invalid OTP");
    });
};
</script>

<div id="recaptcha-container"></div>
